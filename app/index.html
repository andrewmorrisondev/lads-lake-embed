<!DOCTYPE html>
  <html lang='en'>
  <head>
      <meta charset='UTF-8'>
      <meta name='viewport' content='width=device-width, initial-scale=1.0'>
      <title>Geolocation iFrame</title>
  </head>
  <body>
      <script>
        //   import frisbeePositions from '../frisbeePositions.js'
          let frisbeePositions = [[40.6964, -73.9101],[40.6965, -73.9102],[40.6966, -73.9103],[40.6966, -73.9104],[40.6966, -73.9105],[40.6966, -73.9106],[40.6966, -73.9107],[40.6966, -73.9108],[40.6966, -73.9109],[40.6966, -73.9110],[40.6966, -73.9111],[40.6955, -73.9095],[40.6950, -73.9093]]
          let watchID = null;
          function determineDistanceAndDirection(startPos, endPos){
            let distAndDirection = {distance: 0, direction: "", giveClue: false};
            let [a,b] = startPos;
            let [x,y] = endPos;
            a *= 364000
            b *= 364000
            x *= 364000
            y *= 364000
            distAndDirection.distance = Math.floor(Math.sqrt(Math.pow(Math.abs(a-x), 2) + Math.pow(Math.abs(b-y),2)));
            if (distAndDirection.distance>20){
                let ns = ""
                let ew = ""
                if(Math.abs(a-x)>20 && a<x){ ns = "North"};
                if(Math.abs(b-y)>20 && b<y){ ew = "East" };
                if(Math.abs(a-x)>20 && a>x){ ns = "South"};
                if(Math.abs(b-y)>20 && b>y){ ew = "West"};
                distAndDirection.direction = ns + ew;
            } else {
                distAndDirection.direction = "You Made It"
                distAndDirection.giveClue = true
            }
            return distAndDirection
          }

          function startWatching() {
              if (navigator.geolocation) {
                  if (watchID === null) {
                      watchID = navigator.geolocation.watchPosition(
                          (position) => {
                            const lat = parseFloat(position.coords.latitude.toFixed(4));
                            const lon = parseFloat(position.coords.longitude.toFixed(4));
                            let data = {user:{latitude: lat, longitude: lon}}
                            frisbeePositions.forEach((position, i)=>{
                                let dataToFrisbee = determineDistanceAndDirection([lat,lon], position)
                                dataToFrisbee.latitude = position[0]
                                dataToFrisbee.longitude = position[1]
                                data[`fris${i + 1}`] = dataToFrisbee
                            })

                            // Send the latitude and longitude to the parent container
                            // and for each frisbee number: latitude, longitude, distance (in feet), direction, clue boolean
                            window.parent.postMessage(data, '*');
                            console.log("latitude: ", lat)
                            console.log("longitude: ", lon)
                            console.log("data: ")
                            console.log(data)
                          },
                          (error) => {
                              switch (error.code) {
                                  case error.PERMISSION_DENIED:
                                      console.error('User denied the request for Geolocation.');
                                      break;
                                  case error.POSITION_UNAVAILABLE:
                                      console.error('Location information is unavailable.');
                                      break;
                                  case error.TIMEOUT:
                                      console.error('The request to get user location timed out.');
                                      break;
                                  case error.UNKNOWN_ERROR:
                                      console.error('An unknown error occurred.');
                                      break;
                              }
                          },
                          {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0,
                          }
                      );
                  } else {
                      console.log('Already watching position.');
                  }
              } else {
                  console.error('Geolocation is not supported by this browser.');
              }
          }

          function stopWatching() {
              if (watchID !== null) {
                  navigator.geolocation.clearWatch(watchID);
                  console.log('Stopped watching position.');
                  watchID = null;
              }
          }

          // Automatically start watching when the iframe loads
          window.onload = startWatching;
      </script>
  </body>
</html>